[
  {
    "name": "op_scim_bridge",
    "image": "1password/scim:${scim_bridge_version}",
    "cpu": 128,
    "memory": 512,
    "essential": true,
    "dependsOn": [
      {
        "containerName": "mount-secrets",
        "condition": "SUCCESS"
      },
      {
        "containerName": "redis",
        "condition": "HEALTHY"
      }
    ],
    "portMappings": [
      {
        "containerPort": 3002,
        "hostPort": 3002,
        "protocol": "tcp"
      }
    ],
    "environment": [],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${aws_logs_group}",
        "awslogs-region": "${region}",
        "awslogs-stream-prefix": "ecs"
      }
    },
    "mountPoints": [
      {
        "containerPath": "/home/opuser/.op",
        "sourceVolume": "secrets"
      }
    ],
    "volumesFrom": [],
    "systemControls":[]
  },
  {
    "name": "redis",
    "image": "redis",
    "cpu": 128,
    "memory": 512,
    "essential": true,
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${aws_logs_group}",
        "awslogs-region": "${region}",
        "awslogs-stream-prefix": "ecs"
      }
    },
    "portMappings": [],
    "environment": [],
    "command": [
      "--maxmemory 256mb",
      "--maxmemory-policy volatile-lru",
      "--save \"\""
    ],
    "healthCheck": {
      "command": [
        "CMD-SHELL",
        "redis-cli ping | grep PONG"
      ],
      "interval": 30,
      "retries": 3,
      "timeout": 5
    },
    "mountPoints": [],
    "volumesFrom": [],
    "systemControls":[]
  },
  {
    "name": "mount-secrets",
    "essential": false,
    "image": "public.ecr.aws/aws-cli/aws-cli",
    "portMappings": [],
    "mountPoints": [
      {
        "containerPath": "/aws",
        "sourceVolume": "secrets"
      }
    ],
    "environment": [
      {
        "name": "SCIMSESSION_ARN",
        "value": "${secret_arn}"
      }
    ],
    "entryPoint": [
      "/bin/bash",
      "-c"
    ],
    "command": [
      "aws secretsmanager get-secret-value --secret-id $SCIMSESSION_ARN --query SecretString --output text > scimsession"
    ],
    "logConfiguration": {
      "logDriver": "awslogs",
      "options": {
        "awslogs-group": "${aws_logs_group}",
        "awslogs-region": "${region}",
        "awslogs-stream-prefix": "ecs"
      }
    },
    "systemControls": [],
    "volumesFrom": []
  }
]