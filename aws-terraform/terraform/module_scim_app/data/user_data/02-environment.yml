write_files:
    - content: |
        REDIS="${REDIS}"
        REDISPORT="${REDISPORT}"
        SCIM_USER="${SCIM_USER}"
        SCIM_GROUP="${SCIM_GROUP}"
        SCIM_PATH="${SCIM_PATH}"
        SCIM_SESSION_PATH="${SCIM_SESSION_PATH}"
      path: /etc/default/op-scim
      permissions: '644'

runcmd:
    # download and install application (optional)
    #- aws s3 cp s3://${APP_BUCKET}/version/application.tar.bz2 - --region ${BUCKET_REGION}  | tar -jxvof - -C /
    # fetch encrypted scimsession, and set owner and permissions (optional)
    - bash -vc "[ ! -d `dirname "${SCIM_SESSION_PATH}"` ] && mkdir -p `dirname "${SCIM_SESSION_PATH}"`"
    - aws secretsmanager get-secret-value --secret-id ${SCIM_SESSION_SECRET} --region ${REGION} --output text --query SecretBinary | base64 --decode > ${SCIM_SESSION_PATH}
    - chmod -v 600 ${SCIM_SESSION_PATH}
